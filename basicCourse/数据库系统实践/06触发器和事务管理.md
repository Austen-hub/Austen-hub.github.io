# 数据库系统实践
## 06触发器和事务管理
#### 1. 触发器
###### 举例
- 请使⽤“⼀……就……”的句型造句
    + ⼀玩起游戏，就废寝忘⾷
    + 上数据库实践课，就晕⻋
    + ⿏标⼀点击菜单项，就弹出设置对话框
    + Windows事件驱动
        * 你点什么按钮（即产⽣什么事件），电脑执⾏什么操作（即调⽤什么函数）
![触发器举例](https://github.com/Austen-hub/Austen-hub.github.io/blob/master/basicCourse/images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5-%E8%A7%A6%E5%8F%91%E5%99%A8%E4%B8%BE%E4%BE%8B.jpg?raw=true)  
###### 创建并使用触发器
- 触发器
    + 定义一系列操作（触发程序）
    + 触发事件发生→触发程序自动运行
    + 用于检测数据表添、删、改操作
    + 激活触发程序
    + 实现数据自动维护
- 创建触发器语法
```sql
CREATE TRIGGER trigger_name
    {BEFORE|AFTER}
    {UPDATE|INSERT|DELETE}
ON table_name
FOR EACH ROW
trigger_statements
```
    + 语法说明
        * trigger_name
            - 触发器名称，当前库中唯一
        *  BEFORE | AFTER
            -  触发时机
        *  UPDATE | INSERT | DELETE
            -  触发类型
        *  table_name
            -  触发器关联数据表
            -  永久表，非临时表或视图
            -  时机+类型：唯一
        *  FOR EACH ROW
            - 提醒：针对每行都触发
        * trigger_statements
            - 触发程序体
            - 可使用BEGIN...END结构
            - 同存储过程结构
- 字段值的引用
    + OLD
        * 原字段值
    + NEW
        * 新字段值
    + INSERT
        * 只有NEW字段值
    + UPDATE
        * 修改前是OLD原值
        * 修改后是NEW新值
    + DELETE
        * 只有OLD原值
```
#添加交易记录检查。交易⾦额必须不超过500，否则，不“添加”记录
DELIMITER $$
CREATE TRIGGER
    tr_translog_before_insert
    BEFORE INSERT ON translog
    FOR EACH ROW
BEGIN
    IF(NEW.amount<=500)
    THEN
        SET NEW.amount=NEW.amount;
    ELSE    #⾮法，执⾏⾮法语句，使失败退出
        INSERT INTO mytable VALUES(0);
    END IF;
END;
$$
DELIMITER ;
```
###### 查看触发器
###### 删除触发器
###### 触发器的应用
#### 2. 事务管理
