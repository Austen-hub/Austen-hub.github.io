## 02数据库设计基础及MySQL概述
#### 1.数据库设计概述
###### 数据库系统概念
- 数据库（Database，DB）是“按照某种数据结构对数据进行组织、存储和管理的容器”
- 数据库系统（Database System，DBS）是指在计算机中引入数据库后的系统，一般由数据库、数据库管理系统、应用程序、数据库管理员组成
- 数据库系统按照一定的数据模型来组织数据，常用的模型包括“层次模型”、“网状模型”、“关系模型”、“面向对象模型”等
###### 关系数据库
- 由E.F.Codd博士于1976年提出，其发表论文中阐述了关系数据库模型及其原理，并将其用于数据库系统
- 使用关系模型对数据进行组织、存储和管理的数据库称为关系数据库，关系数据库是支持关系数据模型的数据库系统
- 在关系数据库中所谓的“关系”，实际上是一张二维表。表是逻辑结构而不是物理结构，系统在物理层可以使用任何有效的存储结构来存储数据
###### 结构化查询语言SQL
- 结构化查询语言（Structured Query Language，SQL）是一种统一的、非过程化的专门用于与数据库通信（查询）的语言。
- SQL包括三部分：
    + 数据定义语言DDL（Data Definition Language）
    + 数据操纵语言DML（Data Manipulatioin Language）
    + 数据控制语言DCL（Data Control Language）
###### SQL基本功能
- SQL包括数据定义、数据查询、数据操纵以及数据控制四个基本功能  

|  基本功能  | SQL关键字  |
|  ----  | ----  |
| 数据定义 | CREATE，DROP，ALTER |
| 数据查询 | SELECT |
| 数据操纵 | INSERT，UPDATE，DELETE |
| 数据控制 | GRANT，REVOKE |

- 数据库设计基本步骤
    1. **需求分析阶段**  
    需求分析是数据库设计的第一步，其主要任务是对现实世界要处理的对象（公司、部门、企业）进行详细调查，收集支持系统目标的基础数据及其处理方法
    2. **概念结构设计阶段**  
    概念结构设计阶段是整个数据库设计的关键。通过对用户需求进行综合、归纳和抽象，形成一个独立于具体DBS的模型概念
    3. **逻辑结构设计阶段**  
    逻辑结构设计阶段将概念结构转换为某个DBS所支持的数据模型，并将其性能进行优化  
    4. **物理结构设计阶段**  
    数据库物理结构设计阶段是对已经确定的数据库逻辑结构，以较优的存储结构、数据存储路径、合理的数据存储位置以及存储分配
    5. **数据库实施阶段**  
    在数据库实施阶段运用DBMS提供的数据语言（例如，SQL）以及宿主语言（例如，C），根据逻辑设计和物理设计的结果建立数据库，编制与调试应用程序，租住数据入库，并进行试运行
    6. **数据库运行与维护阶段**  
    数据库应用系统经过试运行后即可投入正式运行，在运行过程中需要不断对其进行调整、修改与完善  
#### 2.关系模型及E-R图
###### 关系模型和关系数据库
- 关系模型是目前最重要、应用最广泛的数据模型
    + 关系是一张二维表，由行和列组成
- 一个关系数据库通常包含多个二维表（称为数据库表），来存储和维护各类信息
    + 表与表之间的关联性由主键、外键所体现的参照关系实现
- 此外，关系数据库还包含其他数据库对象，如关系图、视图、存储过程、函数和索引等
###### 主码和外码
- 关系数据库中的一个表是由行和列组成的，并且要求表中的每行记录必须唯一。在设计表时，可以通过定义主码（primary key）来保证记录（实体）的唯一性
- 一个表的主码由一个或多个字段组成，值具有唯一性、且不允许为空。主键的作用是唯一的标识表中的每一条记录
###### 完整性约束
- 在设计表时，可对表中的某个字段或多个字段的组合设置约束条件
- 由数据库管理系统（如MySQL）自动检测输入的数据是否满足约束条件，不满足约束条件的数据将被数据库管理系统拒绝录入
- 数据完整型约束通常包括是实体完整性约束和参照完整性约束
###### 常见约束条件
- 实体完整性约束
    + 主码约束
    + 非空约束
    + 唯一性约束
- 参照完整性约束
    + 外码约束
    + Check约束（可以用触发器实现）
###### E-R图
- 关系数据库概念设计要设计出实体联系图（即Entity-Relationship Diagram，E-R图）
- E-R图由实体集和联系集构成
    + 实体集：表示现实世界具有相同属性描述的事务的集合（一类事物的统称）。E-R图中的实体集通常使用矩形表示
    + 联系集：不同实体集之间的联系集合。在E-R图中联系集用菱形来表示
###### 实体集的属性
- 实体集的属性通常表示实体的某种特征，也可以使用属性来表示实体间联系的特征
- 一个实体集通常包含多个属性，每个属性由属性名唯一标记
###### 二元联系集
- 联系集的类型一般有三种：一对一、一对多、多对多的联系
###### 三元联系集
- 对于供应商、项目和零件三个实体，一个供应商可以供给多个项目多种零件；一个项目可以使用不同供应商的多种零件；一个零件可以由多个供应商供给多个项目
###### E-R图的设计原则
- 数据库设计通常采用“一事一地”原则
    + 属性应该存在且仅存在于某一个地方（实体集或联系集）：该原则避免了同一数据存储于多个数据表中，从而避免数据冗余
    + 实体是一个单独的个体，不能存在于另一个实体中成为其属性：该原则确保一个数据库表中不能包含另一个数据库表
    + 同一个实体在同一个E-R图中仅出现一次：同一个E-R图中两个实体集之间可以存在多个联系集
#### 3.MySQL数据库概述
###### MySQL数据库简介
- MySQL是一个开源的关系型数据库管理系统
    + MySQL由瑞典MySQL AB公司开发；2008年1月，MySQL AB被Sun公司收购；2009年4月，Sun公司又被Oracle公司收购
- 由于MySQL具有体积小、运行速度快、成本低，尤其是开放源码这一特点，许多中小型网站选择MySQL作为网站数据库
###### MySQL存储引擎
- 存储引擎：如何存储数据、如何为存储的数据建立索引和如何更新、查询数据   
    + 在关系数据库中，数据以表的形式存储，所以存储引擎也可以称为表类型
- MySQL提供了插件式（pluggable)的存储引擎，存储引擎是基于表的（用户也可以自定义）
    + 同一个数据库，不同的表，存储引擎可以不同（MySQL数据库中典型的数据库对象包括表、视图、索引、存储过程、函数、触发器等。其中，表是最为重要的数据库对象。使用SQL语句“create table 表名”可创建一个数据库表，在创建数据库表之前，必须首先明确该表的存储引擎；）
    + 同一个数据库表在不同的场合可以应用于不同的存储引擎，最大化设计灵活性
###### InnoDB存储引擎
- 与其他存储引擎相比，InnoDB存储引擎是事务（Transaction）安全的，并且支持外键。
    + 可提供联机事务处理（OLTP）支持，执行大量的增、删、改操作（insert,delete,update）
- InnoDB数据存储格式：共享表空间和独占表空间
    + 共享表空间：所有表、索引等数据放于一个文件中
    + 独占表空间：每张表数据生成独立的一个文件存储
    + innodb_file_per_table(ON是独占表，默认OFF是共享表)
###### MyISAM存储引擎
- MyISAM存储引擎是基于传统观点ISAM（Indexed Sequential Access Method，有索引的顺序访问方法），是MySQL默认存储引擎
    + 与其他存储引擎相比，MyISAM表格可以被压缩，且支持全文搜索，拥有较高的插入和查询速度。如果执行大量的查询操作时，MyISAM是较好的选择
    + 但MyISAM不是事务安全的，且不支持外键。如果事务回滚将造成不完全回滚，不具有原子性。
###### MySQL存储引擎的选择
- 选择存储引擎时，应根据应用特点为不同的表选择合适的存储引擎
    + 当不需要事务支持、并发相对较低、数据修改相对较少、以读为主、数据一致性要求不高的场合，适合选用MyISAM存储引擎
    + 当需要事务支持，行级锁定对高并发有很好的适应能力，但需要确保查询是通过索引完成的、数据更新较为频繁的浐河，适合选用InnoDB存储引擎
#### 4.MySQL表基本操作
###### MySQL数据库的基本操作
- 可通过控制台命令或可视化操作工具对MySQL数据库进行操作
    + 比较常用的有MySQL-Front、MySQL Workbench及Navicat for MySQL等，本课使用Navicat for MySQL
    + MySQL数据库基本操作包括
        * 创建、查看、显示、使用和删除MySQL数据库
        * 创建、查看、修改和删除MySQL数据库表
###### 创建数据库
- 创建数据库：  
create database 数据库名;
- 设置数据库字符集：
alter database 数据库名 character set utf8;
- 查看MySQL数据库文件存放路径：
show variables like 'datadir';
###### 查看数据库
- 查看当前MySQL服务器上的数据库列表：  
show databases;
###### 显示数据库
- 查看数据库的相关信息，如默认字符集等：  
show create database 数据库名;
###### 选择当前数据库  
- 使用SQL语句USE即可指定当前数据库：　　
use 数据库名;
- 如果选择数据库成功，将会出现“database changed"的提示信息。
###### 删除数据库
- 使用DROP删除一个指定的数据库：   
drop database 数据库名;
- 如果删除成功，将会出现“Query OK，0 rows affected”的提示信息。
###### 创建数据库表
- 使用CREATE TABLE语句创建表的基本语法格式如下：    
create table [if not exists] 表名
(字段名1，数据类型【约束】,  
字段名1，数据类型【约束】,  
......  
字段名1，数据类型【约束】
【其他约束条件】  
)【其他选项】;   
- 定义字段时常用的关键字：
    + AUTO_INCREMENT：用于设置整数类型字段的自动增量属性。AUTO_INCREMENT字段必须被索引，而且必须为NOT NULL。每个表最多只能有一个自动具有改属性。
    + DEFAULT：表中添加新行时给表中的某一字段指定的默认值。使用DEFAULT定义，一是可以避免NOT NULL值的数据错误；二是可以加快用户的输入速度。
    + NOT NULL：指定NOT NULL字段，不能有NULL值。
    + UNSIGNED：表示该值不能为负数。
    + PRIMARY KEY, UNIQUE, FOREIGN KEY（仅InnoDB）
```
use bookstore;
create table users
(
    uid int not null primary key auto_increment,
    name varchar(20) not null unique,
    pwd varchar(20) not null,
    sex char(2)
)engine= InnoDB;
```
###### 查看数据库表结构   
describe 表名；   
show columns from 表名；
###### 修改数据库表结构
alter table 表名 action [,action]...;   
其中，每个动作（ACTION）指的是对表所做的修改。MySQL支持一条ALTER TABLE语句带多个动作，用逗号分割   
ACTION的语法格式如下：   
{ ADD COLUMN <列名> <类型>  
| CHANGE COLUMN <旧列名> <新列名> <新列类型>  
| ALTER COLUMN <列名> { SET DEFAULT <默认值> | DROP DEFAULT }  
| MODIFY COLUMN <列名> <类型>  
| DROP COLUMN <列名>  
| RENAME TO <新表名> } 
###### 删除数据库表
drop table [if exists] 表名1 [,表名2，...];
